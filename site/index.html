<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>US Presidential Map</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="container">
  <div class="header">
  <h1>U.S. Presidential Election Explorer</h1>
  <button id="theme-toggle" aria-label="Toggle theme">ğŸŒ™</button>
    <span class="legend">Static alpha Â· click a state to open its page</span>
  </div>
  <div class="grid">
    <div class="card">
      <div id="map-wrap" class="center">
        <svg id="map" width="100%" viewBox="0 0 975 610" aria-label="U.S. map"></svg>
      </div>
    </div>
    <div class="card">
      <h2 style="margin-top:0">Small States Â· Quick Links</h2>
      <div class="small-links" id="small-links"></div>
      <hr/>
      <p class="legend">Tip: Maine and Nebraskaâ€™s statewide pages include big links to their district pages.</p>
    </div>
  </div>
  <footer>Built as static HTML from CSV. D3 + us-atlas map is loaded from CDNs.</footer>
</div>

<!-- use specific UMD bundles so topojson exposes a global `topojson` and d3 is the UMD build -->
<script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson-client@3/dist/topojson-client.min.js"></script>
<script>
const FIPS_TO_ABBR = {
  "01":"AL","02":"AK","04":"AZ","05":"AR","06":"CA","08":"CO","09":"CT","10":"DE","11":"DC",
  "12":"FL","13":"GA","15":"HI","16":"ID","17":"IL","18":"IN","19":"IA","20":"KS","21":"KY","22":"LA",
  "23":"ME","24":"MD","25":"MA","26":"MI","27":"MN","28":"MS","29":"MO","30":"MT","31":"NE","32":"NV",
  "33":"NH","34":"NJ","35":"NM","36":"NY","37":"NC","38":"ND","39":"OH","40":"OK","41":"OR","42":"PA",
  "44":"RI","45":"SC","46":"SD","47":"TN","48":"TX","49":"UT","50":"VT","51":"VA","53":"WA","54":"WV",
  "55":"WI","56":"WY"
};
const SMALL_STATES = ['DC', 'DE', 'RI', 'CT', 'NJ', 'MD', 'MA', 'VT', 'NH'];

const svg = d3.select("#map");
const g = svg.append("g");
const path = d3.geoPath();

// Draw map using us-atlas topojson
fetch("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json")
  .then(r => r.json())
  .then(us => {
    const states = topojson.feature(us, us.objects.states).features;

    // background rect uses CSS variable via class
    svg.append("rect").attr("class", "map-bg").attr("width", 975).attr("height", 610);

    g.selectAll("path.state")
      .data(states)
      .join("path")
      .attr("class", "state")
      .attr("d", path)
      .attr("tabindex", 0)
      .on("mouseover", function() { d3.select(this).classed('hover', true); })
      .on("mouseout",  function() { d3.select(this).classed('hover', false); })
      .on("click", (event, d) => {
        const abbr = FIPS_TO_ABBR[String(d.id).padStart(2,"0")];
        if (abbr) window.location.href = "state/" + abbr + ".html";
      })
      .append("title")
      .text(d => {
        const abbr = FIPS_TO_ABBR[String(d.id).padStart(2,"0")];
        return abbr ? abbr : "Unknown";
      });

    // Small state buttons
    const links = d3.select("#small-links");
    SMALL_STATES.forEach(abbr => {
      links.append("a")
        .attr("class","btn")
        .attr("href","state/" + abbr + ".html")
        .text(abbr);
    });
  })
  .catch(err => {
    console.error('Map load failed:', err);
    d3.select('#map-wrap').append('div').attr('class','legend').text('Map failed to load. Check network or console for details.');
  });

// Theme toggle: default dark, allow toggling to light and persist preference
(function(){
  const btn = document.getElementById('theme-toggle');
  const root = document.documentElement;
  const current = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
  if(current === 'light') document.body.classList.add('light');
  btn.textContent = document.body.classList.contains('light') ? 'â˜€ï¸' : 'ğŸŒ™';
  btn.addEventListener('click', () => {
    const isLight = document.body.classList.toggle('light');
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
    btn.textContent = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
  });
})();
</script>
</body>
</html>
