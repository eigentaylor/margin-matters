<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>State Trends • Trend Viewer</title>
  <link rel="icon" href="./favicon.svg" />
  <link rel="stylesheet" href="./styles.css" />
  <style>
    :root{--bg:#0b0b0b;--fg:#f5f5f5;--muted:#a5a5a5;--accent:#66b3ff;--card:#141414;--border:#2a2a2a}
    body{background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial}
    a{color:var(--accent)}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
  .controls{display:grid;grid-template-columns:1fr;gap:12px;align-items:end}
  @media (min-width: 700px){ .controls{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
  @media (min-width: 1050px){ .controls{ grid-template-columns: repeat(4, minmax(0,1fr)); } }
    .controls .field{display:flex;flex-direction:column;gap:6px}
    .controls label{font-size:.9rem;color:var(--muted)}
    .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    .badge{display:inline-block;padding:4px 8px;border:1px solid var(--border);border-radius:999px;color:var(--muted)}
    #chart{width:100%;height:560px}
    .tooltip{position:fixed;pointer-events:none;background:#111;border:1px solid var(--border);padding:8px 10px;border-radius:8px;color:var(--fg);font-size:.95rem;opacity:0;transform:translateY(-6px);transition:opacity .12s ease, transform .12s ease}
    .legend{display:flex;gap:10px;align-items:center;margin-top:8px;color:var(--muted)}
    .legend .sw{width:14px;height:14px;border-radius:4px;border:1px solid var(--border)}
    .legend .lab{font-size:.9rem}
    .spacer{height:6px}
  .select-dark{background:var(--card);color:var(--fg);border:1px solid var(--border);padding:6px;border-radius:6px}
  .btn-dark{background:var(--card);color:var(--fg);border:1px solid var(--border);padding:6px 10px;border-radius:6px}
  .presets-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .state-chips{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
  @media (max-width: 520px){
    #chart{height:400px}
  }
  </style>
</head>
<body>
  <div class="container">
    <div class="card site-header" style="display:flex;justify-content:space-between;align-items:center;padding:8px;margin-bottom:12px">
      <div class="small-links"><a class="btn" href="./index.html">Home</a><a class="btn" href="./state-pages.html">State Pages</a><a class="btn" href="./ranker.html">Ranker</a><a class="btn" href="./trend-viewer.html">Trend Viewer</a><a class="btn" href="./methods.html">Methods</a><a class="btn" href="./presidential_margins.html">Data (CSV)</a></div>
  <div class="legend">Trend Viewer</div>
    </div>

    <div class="card" style="margin-bottom:12px">
      <div class="controls">
        <div class="field">
          <label for="stateSel">State</label>
          <select id="stateSel" class="select-dark"></select>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="addStateBtn" class="btn btn-dark">Add state</button>
            <div class="presets-row" style="display:flex;gap:6px;align-items:center;flex-wrap:wrap">
              <label class="badge">Presets:</label>
              <select id="presetSel" class="select-dark">
                <option value="">— choose —</option>
                <option value="preset1">WI/MI/PA</option>
                <option value="preset2">2024 Swings</option>
                <option value="preset3">Maine (ME + districts)</option>
                <option value="preset4">Nebraska (NE + districts)</option>
              </select>
              <!--<button id="resetBtn" class="btn btn-dark" title="Reset to defaults">Reset</button>-->
            </div>
          </div>
          <div id="stateChips" class="state-chips" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"></div>
        </div>
        <div class="field">
          <label for="metricSel">Metric</label>
          <select id="metricSel" class="select-dark">
            <option value="margin" selected>Margin</option>
            <option value="thirdParty">Third-Party Share</option>
          </select>
        </div>
        <div class="field">
          <label>Year range</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="startYear" type="number" style="width:100px" value="1916" step="4" min="1916" max="2024" />
            <span style="color:var(--muted)">to</span>
            <input id="endYear" type="number" style="width:100px" value="2024" step="4" min="1916" max="2024" />
          </div>
        </div>
        <div class="field">
          <label for="chartSel">Chart type</label>
          <select id="chartSel" class="select-dark">
            <option value="auto" selected>Auto</option>
            <option value="line">Line</option>
            <option value="bar">Bar</option>
          </select>
        </div>
        <div class="field">
          <label>Options</label>
          <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="relativeChk" /> Relative</label>
          <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="deltaChk" /> Delta</label>
          <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="twoPartyChk" /> Two-party</label>
        </div>
        <div class="field">
          <label>Display</label>
          <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="natOverlay" /> National overlay</label>
          <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="pointsToggle" checked /> Show points</label>
        </div>
      </div>
      <div class="spacer"></div>
      <div class="legend" id="legend">
        <div class="row" style="gap:14px;align-items:center">
          <div class="row" style="gap:8px;align-items:center"><div class="sw" style="background:#4ade80"></div><div class="lab">State</div></div>
          <div class="row" style="gap:8px;align-items:center"><div class="sw" style="background:#f472b6"></div><div class="lab">National</div></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap">
        <div class="legend" style="flex:1 1 auto;min-width:240px">Use presets or chips to compare multiple states.</div>
        <button id="shareBtn" class="btn btn-dark" title="Copy link to this view" style="flex:0 0 auto">Share</button>
      </div>
      <div id="chart"></div>
      <div id="notes" style="margin-top:8px;color:var(--muted);font-size:.92rem"></div>
    </div>

    <footer style="margin-top:16px;color:var(--muted)">
      This experimental page doesn’t affect the main site. When it’s ready, we can integrate it into the build.
     <span class="legend">Last updated: 2025-09-19 23:15 UTC</span></footer>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="./utils/siteState.js"></script>
  <script src="./trend-viewer.js"></script>
  <script>
    // Wire Share button using shared SiteState helper
    (function(){
      const btn = document.getElementById('shareBtn');
      if (!btn || !window.SiteState) return;
      btn.addEventListener('click', function(){
        const url = window.SiteState.copyCurrentUrl();
        btn.textContent = 'Copied!';
        setTimeout(()=>{ btn.textContent = 'Share'; }, 1200);
      });
    })();
  </script>
</body>
</html>
